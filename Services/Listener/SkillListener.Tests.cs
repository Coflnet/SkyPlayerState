using System.Collections.Generic;
using System.Linq;
using Coflnet.Sky.PlayerState.Tests;
using FluentAssertions;
using Newtonsoft.Json;
using NUnit.Framework;

namespace Coflnet.Sky.PlayerState.Services;

public class SkillListenerTest
{
    [Test]
    public void Parse()
    {
        var json = """
        [{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":"§aYour Skills","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"§7View your Skill progression and\n§7rewards.\n\n§624.9 Skill Avg. §8(non-cosmetic)\n\n§eClick to show rankings!","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":"§aCombat XXVIII","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"§7Fight mobs and special bosses to\n§7earn Combat XP!\n\n§7Progress to Level XXIX: §e6.8%\n§2§l§m  §f§l§m                       §r §e74,415§6/§e1.1M\n\n§7Level XXIX Rewards:\n  §eWarrior XXIX\n    §7§fDeal §8112➜§a116%§f more damage to mobs.\n  §7§8+§a0.5% §9☣ Crit Chance\n  §7§8+§6325,000 §7Coins\n  §7§8+§b20 SkyBlock XP\n\n§eClick to view!","Count":1},{"Id":null,"ItemName":"§aFarming XXXII","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"§7Harvest crops and shear sheep to\n§7earn Farming XP!\n\n§7Progress to Level XXXIII: §e12.5%\n§2§l§m    §f§l§m                     §r §e187,980.4§6/§e1.5M\n\n§7Level XXXIII Rewards:\n  §eFarmhand XXXIII\n    §7§fGrants §a+§8128➜§a132§f §6☘ Farming\n    §6Fortune§f, which increases your\n    §fchance for multiple crops.\n  §7§8+§a5 §c❤ Health\n  §7§8+§6425,000 §7Coins\n  §7§8+§b20 SkyBlock XP\n\n§eClick to view!","Count":1},{"Id":null,"ItemName":"§aFishing XXII","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"§7Visit your local pond to fish and\n§7earn Fishing XP!\n\n§7Progress to Level XXIII: §e14.9%\n§2§l§m    §f§l§m                     §r §e74,374.2§6/§e500k\n\n§7Level XXIII Rewards:\n  §eTreasure Hunter XXIII\n    §7§fGrants §a+§82.2➜§a2.3§f §6⛃ Treasure Chance§f.\n  §7§8+§a4 §c❤ Health\n  §7§8+§6175,000 §7Coins\n  §7§8+§b10 SkyBlock XP\n\n§eClick to view!","Count":1},{"Id":null,"ItemName":"§aMining L","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"§7Dive into deep caves and find rare\n§7ores and valuable materials to earn\n§7Mining XP!\n\n§7Progress to Level LI: §e72.2%\n§2§l§m                   §f§l§m      §r §e3,104,014.5§6/§e4.3M\n\n§7Level LI Rewards:\n  §eSpelunker LI\n    §7§fGrants §a+§8200➜§a204§f §6☘ Mining Fortune§f,\n    §fwhich increases your chance for\n    §fmultiple ore drops.\n  §7§8+§a2 §a❈ Defense\n  §7§8+§61,000,000 §7Coins\n  §7§8+§b30 SkyBlock XP\n\n§eClick to view!","Count":1},{"Id":null,"ItemName":"§aForaging XXIV","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"§7Cut trees and forage for other\n§7plants to earn Foraging XP!\n\n§7Progress to Level XXV: §e44.3%\n§2§l§m            §f§l§m             §r §e309,823.2§6/§e700k\n\n§7Level XXV Rewards:\n  §eLogger XXV\n    §7§fGrants §a+§896➜§a100§f §6☘ Foraging\n    §6Fortune§f, which increases your\n    §fchance for multiple logs.\n  §7§8+§a2 §c❁ Strength\n  §7§8+§6225,000 §7Coins\n  §7§8+§b10 SkyBlock XP\n\n§eClick to view!","Count":1},{"Id":null,"ItemName":"§aEnchanting X","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"§7Enchant items to earn Enchanting XP!\n\n§7Progress to Level XI: §e61.7%\n§2§l§m                §f§l§m         §r §e3,084.8§6/§e5k\n\n§7Level XI Rewards:\n  §eConjurer XI\n    §7§fGain §850➜§a55%§f more experience orbs\n    §ffrom any source.\n  §7§8+§a0.5% §c๑ Ability Damage\n  §7§8+§a1 §b✎ Intelligence\n  §7§aEnder Slayer Enchantment\n  §7§aChance Enchantment\n  §7§8+§610,000 §7Coins\n  §7§8+§b10 SkyBlock XP\n\n§eClick to view!","Count":1},{"Id":null,"ItemName":"§aAlchemy VII","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"§7Brew potions to earn Alchemy XP!\n\n§7Progress to Level VIII: §e80.2%\n§2§l§m                     §f§l§m    §r §e1,203§6/§e1.5k\n\n§7Level VIII Rewards:\n  §eBrewer VIII\n    §7§fPotions that you brew have a §87➜§a8%§f\n    §flonger duration.\n  §7§8+§a1 §b✎ Intelligence\n  §7§8+§64,000 §7Coins\n  §7§8+§b5 SkyBlock XP\n\n§eClick to view!","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":"§aCarpentry XVII","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"§7Craft items to earn Carpentry XP!\n\n§7Progress to Level XVIII: §e51.7%\n§2§l§m             §f§l§m            §r §e38,768.4§6/§e75k\n\n§7Level XVIII Rewards:\n  §7§8+§a1 §c❤ Health\n  §7§fMedium Shelves §7Furniture Recipe\n  §7§8+§665,000 §7Coins\n  §7§8+§b10 SkyBlock XP\n\n§eClick to view!","Count":1},{"Id":null,"ItemName":"§aRunecrafting II","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"§7Slay bosses and runic mobs, and\n§7fuse runes to earn Runecrafting XP!\n\n§7Progress to Level III: §e68.1%\n§2§l§m                  §f§l§m       §r §e85.1§6/§e125\n\n§7Level III Reward:\n  §7§7Access to Level §53 §7Runes\n\n§7§dLevel up Runecrafting to activate the\n§deffects of rune-bearing items!\n\n§eClick to view!","Count":1},{"Id":null,"ItemName":"§aTaming XXXIV","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"§7Level up pets to earn Taming XP!\n\n§7Progress to Level XXXV: §e81.2%\n§2§l§m                     §f§l§m    §r §e1,380,074.8§6/§e1.7M\n\n§7Level XXXV Rewards:\n  §eZoologist XXXV\n    §7§fGain §834➜§a35%§f extra pet exp.\n  §7§8+§fGain §86.8➜§a7% §fExp Share rate.\n  §7§8+§a1 §d♣ Pet Luck\n  §7§8+§6475,000 §7Coins\n  §7§8+§b20 SkyBlock XP\n\n§eClick to view!","Count":1},{"Id":null,"ItemName":"§aSocial IV","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"§7Gain Social XP for every new unique\n§7guest, hosting guests, and visiting\n§7islands!\n\n§7Progress to Level V: §e61.5%\n§2§l§m                §f§l§m         §r §e307.3§6/§e500\n\n§7Level V Rewards:\n  §7§fAbility to purchase §dIsland NPCs §ffrom\n  §fAmelia\n  §7§8+§61,000 §7Coins\n\n§eClick to view!","Count":1},{"Id":null,"ItemName":"§aDungeoneering","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"§7Complete Dungeons to level up your\n§7classes! Unlock new gear and class\n§7upgrades by completing higher tier\n§7dungeons!\n\n§7Requires §bCombat Level 15§7 to enter a\n§7Dungeon.\n\n§eClick to view!","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1},{"Id":null,"ItemName":" ","Tag":null,"ExtraAttributes":null,"Enchantments":null,"Color":null,"Description":"","Count":1}]
        """;
        var items = JsonConvert.DeserializeObject<List<Models.Item>>(json);
        var listener = new SkillListener();
        var result =  listener.ParseSkills(items);
        result.Should().HaveCount(12);
        result.Should().ContainSingle(x => x.Name == "Mining" && x.Level == 50);
        result.Should().ContainSingle(x => x.Name == "Fishing" && x.Level == 22);
        result.Should().ContainSingle(x => x.Name == "Dungeoneering" && x.Level == 0);

    }
}